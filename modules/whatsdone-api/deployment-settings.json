{
    "moduleName": "whatsdone-api",
    "dependsOn": ["../whatsdone-app"],
    "config": {
        "script": "node -p \"JSON.stringify(require('./module-config/$KUMO_ENV.js'))\" | kumo decrypt --profile $KUMO_ENV --inputFormat json"
    },
    "tasks": [
        {
            "id": "deploy-api",
            "type": "cf-stack",
            "stackName": "api",
            "stackTemplate": {
                "script": "cp ./template.json $KUMO_TEMPLATE_OUTPUT_FILE"
            },
            "stackParams": {
                "EnvName": {"$ref": "#/_env"},
                "Region": {"$ref": "#/_taskRegion"},
                "SessionSecret": {"$ref": "#/_deploymentConfig/sessionSecret"},
                "LambdaRole": {"$ref": "#/_deploymentConfig/executionRole"},
                "LambdaS3Bucket": {"$ref": "#/_deploymentOutputs/whatsdone-app/packages/whatsdone-app/s3Bucket"},
                "LambdaS3Key": {"$ref": "#/_deploymentOutputs/whatsdone-app/packages/whatsdone-app/s3Key"}
            }
        }
    ]
}
